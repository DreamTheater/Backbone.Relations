/*!
 * Backbone.Relations v0.1.5
 * https://github.com/DreamTheater/Backbone.Relations
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
Backbone.Model=function(t){"use strict";return t.extend({_RelatedModels:Backbone.Collection.extend({initialize:function(){this.on("add",function(t,e,n){this.model.collection.add(t,n)}),this.on("remove",function(t,e,n){this.model.collection.remove(t,n)})}}),constructor:function(){this._relations={},t.apply(this,arguments),this.collection&&(this.constructor.collection=this.collection)},belongsTo:function(t,e){var n=e.foreignKey;return this._createRelation(t,{get:function(){var e=this.attributes[n];return t.collection.get(e)},set:function(t,e){return this.set(n,t.id,e)},build:function(e,n){return new t(e,n)},create:function(e,n){return t.collection.create(e,n)}},e),this},hasOne:function(t,e){var n=e.foreignKey;return this._createRelation(t,{get:function(){var e=this._makeHash(null,n);return t.collection.findWhere(e)},set:function(t,e){return t.set(n,this.id,e)},build:function(e,i){var o=this._makeHash(e,n);return new t(o,i)},create:function(e,i){var o=this._makeHash(e,n);return t.collection.create(o,i)}},e),this},hasMany:function(t,e){var n=e.foreignKey;return this._createRelation(t,{get:function(){var e=this._RelatedModels,i=this._makeHash(null,n),o=t.collection.where(i);return new e(o,{model:t})}},e),this},toJSON:_.wrap(t.prototype.toJSON,function(t,e){e=e||{};var n=t.call(this,e),i=_.extend({},e,{caller:this});return e.relations&&_.each(this._relations,function(t,o){var r,c=t.Model;e.caller instanceof c||(r=t.reference.get.call(this),n[o]=r.toJSON(i)),delete n[t.options.foreignKey]},this),n}),_createRelation:function(t,e,n){var i=_.string.capitalize(n.as);e.get&&(this["get"+i]=e.get),e.set&&(this["set"+i]=e.set),e.build&&(this["build"+i]=e.build),e.create&&(this["create"+i]=e.create),this._relations[n.as]={Model:t,reference:e,options:n}},_makeHash:function(t,e){var n=_.clone(t)||{};return n[e]=this.id,n}})}(Backbone.Model);