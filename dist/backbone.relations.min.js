/*!
 * Backbone.Relations v0.1.5
 * https://github.com/DreamTheater/Backbone.Relations
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
Backbone.Model=function(e){"use strict";return e.extend({_RelatedModels:Backbone.Collection.extend({initialize:function(){this.on("add",function(e,t,n){this.model.collection.add(e,n)}),this.on("remove",function(e,t,n){this.model.collection.remove(e,n)})}}),constructor:function(){this._relations={},e.apply(this,arguments);var t=this.collection;t&&(this.constructor.collection=t)},belongsTo:function(e,t){var n=t.foreignKey;return this._createRelation(e,{get:function(){var t=this.attributes[n];return e.collection.get(t)},set:function(e,t){return this.set(n,e.id,t)},build:function(t,n){return new e(t,n)},create:function(t,n){return e.collection.create(t,n)}},t),this},hasOne:function(e,t){var n=t.foreignKey;return this._createRelation(e,{get:function(){var t=this._makeHash(null,n);return e.collection.findWhere(t)},set:function(e,t){return e.set(n,this.id,t)},build:function(t,i){var o=this._makeHash(t,n);return new e(o,i)},create:function(t,i){var o=this._makeHash(t,n);return e.collection.create(o,i)}},t),this},hasMany:function(e,t){var n=t.foreignKey;return this._createRelation(e,{get:function(){var t=this._RelatedModels,i=this._makeHash(null,n),o=e.collection.where(i);return new t(o,{model:e})}},t),this},toJSON:_.wrap(e.prototype.toJSON,function(e,t){t=t||{};var n=e.call(this,t),i=_.extend({},t,{caller:this});return t.relations&&_.each(this._relations,function(e,o){var r,c=e.Model;t.caller instanceof c||(r=e.reference.get.call(this),n[o]=r.toJSON(i)),delete n[e.options.foreignKey]},this),n}),_createRelation:function(e,t,n){var i=_.string.capitalize(n.as);t.get&&(this["get"+i]=t.get),t.set&&(this["set"+i]=t.set),t.build&&(this["build"+i]=t.build),t.create&&(this["create"+i]=t.create),this._relations[n.as]={Model:e,reference:t,options:n}},_makeHash:function(e,t){var n=_.clone(e)||{};return n[t]=this.id,n}})}(Backbone.Model);