/**
 * Backbone.Relations v0.1.5
 * https://github.com/DreamTheater/Backbone.Relations
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
(function(){"use strict";var t=Backbone.Model;Backbone.Model=t.extend({_collection:Backbone.Collection.extend({initialize:function(){this.on("add",function(t,e,n){this.model.collection.add(t,n)}),this.on("remove",function(t,e,n){this.model.collection.remove(t,n)})}}),constructor:function(){this._relations={},t.apply(this,arguments);var e=this.collection;e&&(this.constructor.collection=e)},toJSON:_.wrap(t.prototype.toJSON,function(t,e){e=e||{};var n=t.call(this,e),i=_.extend({},e,{caller:this});return e.relations&&_.each(this._relations,function(t,o){var r;e.caller instanceof t.Model||(r=t.reference.get.call(this),n[o]=r.toJSON(i)),delete n[t.options.foreignKey]},this),n}),belongsTo:function(t,e){var n=e.foreignKey;return this._createRelation(t,{get:function(){var e=this.attributes[n];return t.collection.get(e)},set:function(t,e){return this.set(n,t.id,e)},build:function(e,n){return new t(e,n)},create:function(e,n){return t.collection.create(e,n)}},e),this},hasOne:function(t,e){var n=e.foreignKey;return this._createRelation(t,{get:function(){var e=this._makeHash(null,n);return t.collection.findWhere(e)},set:function(t,e){return t.set(n,this.id,e)},build:function(e,i){var o=this._makeHash(e,n);return new t(o,i)},create:function(e,i){var o=this._makeHash(e,n);return t.collection.create(o,i)}},e),this},hasMany:function(t,e){var n=e.foreignKey;return this._createRelation(t,{get:function(){var e=this._makeHash(null,n),i=t.collection.where(e);return new this._collection(i,{model:t})}},e),this},_createRelation:function(t,e,n){var i=n.as,o=_.string.capitalize(i),r=e.get,c=e.set,a=e.build,s=e.create;r&&(this["get"+o]=r),c&&(this["set"+o]=c),a&&(this["build"+o]=a),s&&(this["create"+o]=s),this._relations[i]={Model:t,reference:e,options:n}},_makeHash:function(t,e){var n=_.clone(t)||{};return n[e]=this.id,n}})})();